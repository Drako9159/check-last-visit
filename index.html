<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las visit</title>
</head>

<body>
    <small></small>


    <script type="module">
        const res = await fetch("https://geolocation.microlink.io/")
        const json = await res.json()

        const {
            city: {
                name: city
            },
            country: { name: country, flag }
        } = json

        await fetch("/visit", {
            method: "POST",
            header: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                city, country, flag
            })
        })

        const source = new EventSource("/visit")
        const small = document.querySelector("small")

        source.addEventListener("update", (e) => {
            const { city, country, flag } = JSON.parse(e.data)
            small.innerHTML = `Last visit from ${city}, ${country} ${flag}`
        })
    </script>

</body>

</html>