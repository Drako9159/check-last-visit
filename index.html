<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las visit</title>
</head>

<style>
    body {
        background-color: #000000;
        display: grid;
        place-content: center;
        min-height: 100vh;
    }

    small {
        font-size: 12px;
        color: #f6f6f6;
        text-align: center;
        font-family: Menlo, monospace;
    }
</style>

<body>
    <small>Info</small>

    <script type="module">
        const res = await fetch("https://geolocation.microlink.io/")
        console.log(res)
        const json = await res.json()

        const {
            city: {
                name: city
            },
            country: { name: country, flag }
        } = json

        await fetch("/visit", {
            method: "POST",
            header: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                city, country, flag
            })
        })

        const source = new EventSource("/visit")
        const small = document.querySelector("small")

        source.addEventListener("update", (event) => {
            const { city, country, flag } = JSON.parse(event.data)

            small.innerHTML = `Last visit from ${city}, ${country} ${flag}`
        })
    </script>

</body>

</html>